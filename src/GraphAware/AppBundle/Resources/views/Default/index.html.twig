{% extends "GraphAwareAppBundle:Default:layout.html.twig" %}

{% block content %}
<div class="col-sm-12 main">
    <h1><img src="/images/neolovegithub.png" alt="Neo4j Loves Github"/> </h1>

    {% if is_granted('ROLE_USER') == false %}

    <h3>Demo Application combining Github public events and Neo4j. <br/>

    Import your last 300 Github events into Neo4j in just one click !</h3>

        <p><a class="btn btn-warning" href="{{ hwi_oauth_login_url('github') }}" role="button">Login with Github</a></p>

    {% endif %}
<hr />
</div>

    {% if is_granted('ROLE_USER') %}
    <div class="col-sm-12 main">
        <div class="row">
            <h4>Your statistics</h4>
            <h5>Query used :</h5>
            <pre>
                MATCH (user:User) WHERE user.login = '{{ app.user.login }}'
                MATCH (user)-[:LAST_EVENT|NEXT*]->(event)
                RETURN event.type as eventType, count(*) as counts
            </pre>
            <table class="table">
                {% for index,value in stats %}
                    <tr><td>{{ index }}</td><td>{{ value }}</td></tr>
                {% endfor %}
            </table>
        </div>

        <hr/>

        <div class="row">
            <h4>To which repositories have you contributed ?</h4>
            <h5>Query used :</h5>
            <pre>
                MATCH (user:User) WHERE user.login = '{{ app.user.login }}'
                MATCH (user)-[:LAST_EVENT|NEXT*]->(event)
                MATCH (event)-[:MERGED_PR|OPENED_PR|PUSHED]->(step)
                MATCH (step)-[*1..4]->(repo:Repository)
                RETURN collect(DISTINCT(repo.name)) as repos
            </pre>
            <table class="table">
                {% for repo in repo_contrib %}
                    <tr><td>{{ repo }}</td></tr>
                {% endfor %}
            </table>
        </div>

        <hr />

    </div>
    {% else %}

    <div class="col-sm-12 main">
        <div class="col-sm-4">
            <h4>Users Registered</h4>
            <p>{{ active_users }}</p>
        </div>

        <div class="col-sm-4">
            <h4>Total Github Events</h4>
            <p>{{ total_events }}</p>
        </div>

        <div class="col-sm-4">
            <h4>Total Repositories</h4>
            <p>{{ total_repos }}</p>
        </div>
    </div>

    {% endif %}

{% endblock %}
